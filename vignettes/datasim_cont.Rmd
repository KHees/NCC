---
title: "datasim_cont"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{datasim_cont}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(NCC)
```


# datasim_cont()

The function `datasim_cont()` enables data simulation of a platform trial with continuous endpoint and an arbitrary number of treatment arms entering at different time points.

## Assumptions

- equal sample sizes across all treatment arms
- block randomization is used, a factor to multiply the number of active arms with in order to get the block size in each period can be specified as input argument (`period_blocks`, default=2)

## Notation

<table>
    <tr>
        <td><b>Paper</b></td>
        <td><b>Software</b></td>
    </tr>
    <tr>
        <td>$N$</td>
        <td>n_total</td>
    </tr>
    <tr>
        <td>$K$</td>
        <td>num_arms</td>
    </tr>
    <tr>
        <td>$d$</td>
        <td>d</td>
    </tr>
    <tr>
        <td>$n$</td>
        <td>n_arm</td>
    </tr>
    <tr>
        <td>$\eta_0$</td>
        <td>mu0</td>
    </tr>
    <tr>
        <td>$\theta$</td>
        <td>theta</td>
    </tr>
    <tr>
        <td>$\lambda$</td>
        <td>lambda</td>
    </tr>
    <tr>
        <td>$\sigma$</td>
        <td>sigma</td>
    </tr>
    <tr>
        <td>$N_p$</td>
        <td>N_peak</td>
    </tr>
</table>

## Usage options

### Input

The user has two options to define the sample sizes in the trial:

#### Option 1)

Specify total sample size in the trial (`n_total`), number of treatment arms (`num_arms`) and the timing of adding new arms in terms of number of patients allocated to the control arm (`d`). The sample size per period is then computed using the `get_ss_matrix()` function. The sample sizes in treatment and control arms are varying, based on the 3 specified parameters and the assumptions of equal sample sizes for all treatment arms and 1:1:...:1 allocation ratio in all periods.


#### Option 2)

Specify the sample size per treatment arm (`n_arm`, assumed equal) and a matrix with allocation ratios (`alloc_ratios`) in each period. The matrix with sample sizes per period is then computed based on these input parameters.


#### Other input parameters

- `period_blocks` - number to multiply the number of active arms with in order to get the block size per period (block size = `period_blocks` $\cdot$ #active arms)
- `mu0` - response in the control arm. Default=0
- `theta` - vector with treatment effects for each treatment arm (of length `num_arms`)
- `lambda` - vector with strength of time trend in each arm (of length `num_arms+1`, as time trend in the control is also allowed)
- `sigma` - residual variance
- `trend` - indicates the time trend pattern ("linear", "stepwise" or "inv_u")
- `N_peak` - point at which the inverted-u time trend switches direction in terms of overall sample size
- `full` - Boolean. Indicates whether the full dataset should be returned. Default=`FALSE`


### Output

Per default (using `full=FALSE`), the function outputs a dataframe with simulated trial data needed for the analysis. If the parameter `full` is set to `TRUE`, the output is a list containing an extended version of the dataframe (also including lambdas and underlying responses) and all input parameters.

### Examples

```{r}
# Usage option 1

head(datasim_cont(n_total = 1000, num_arms = 3, d = 120, 
                  theta = rep(0.25, 3), lambda = rep(0.15, 4), 
                  sigma = 1, trend = "linear"))
```


```{r}
# Usage option 2

head(datasim_cont(n_arm = 200, alloc_ratios = matrix(c(1,1,1,
                                                       1,1,NA,
                                                       NA,1,1), ncol = 3, byrow = T),
                  theta = rep(0.25, 3), lambda = rep(0.15, 4), 
                  sigma = 1, trend = "linear"))
```

```{r}
# Usage option 1 - full dataset

head(datasim_cont(n_total = 1000, num_arms = 3, d = 120,
                  theta = rep(0.25, 3), lambda = rep(0.15, 4), 
                  sigma = 1, trend = "linear", full = T)$Data)
```



